# AI 视频分镜脚本分析工具 — 产品需求文档

**版本**：v0.2.0
**一句话描述**：用户上传视频，AI 自动分析生成分镜拍摄脚本，支持按分镜预览视频片段和导出表格。

---

## 1. 使用场景

| 用户角色 | 场景 |
|---------|------|
| 短视频创作者 | 拆解优秀视频学习拍摄技巧，用于二次创作 |
| 视频编辑团队 | 编导拆解视频后分发给剪辑师执行 |
| 内容运营人员 | 分析竞品视频结构，提取脚本用于内容策划 |

---

## 2. 功能列表

### F1 - 视频上传

- 支持拖拽和点击两种上传方式
- 支持格式：mp4、mov
- 大小限制：≤100MB
- 时长限制：≤10 分钟
- 上传至阿里云 OSS，获取临时访问链接
- 显示上传进度
- 上传完成后在左上区域预览视频

### F2 - AI 视频分析

- 系统内置默认提示词（分镜拍摄脚本分析），详见 `docs/prd/v0.2.0/prompt.md`
- 调用阿里云百炼 qwen-vl-flash 模型
- 支持流式输出，实时显示分析进度
- 显示 Token 使用统计（输入/输出 Token 数）

### F3 - 分析结果展示

分析结果提供两种展示模式，用户可切换查看：

**模式一：Markdown 原始内容**

- 将 AI 返回的原始 Markdown 内容使用 Markdown 渲染组件直接展示
- 保留 AI 输出的完整格式，便于查看原始分析结果

**模式二：分镜脚本表格**

- 将 AI 返回的 Markdown 表格解析为结构化 JSON 数据
- 使用表格组件渲染，表格字段与提示词（`docs/prd/v0.2.0/prompt.md`）定义的输出格式一致，共 11 列：

| 序号 | 字段名 | 说明 |
| ---- | ------ | ---- |
| 1 | 序号 | 镜头顺序编号 |
| 2 | 景别 | 远景、全景、中景、近景、特写、微距 |
| 3 | 运镜 | 推、拉、摇、移、跟、升降、静止等 |
| 4 | 画面内容 | 客观描述画面中的核心动作和主体 |
| 5 | 拍摄指导 | 反推复刻镜头的具体技法 |
| 6 | 画面文案/花字 | 画面中出现的非语音文字信息 |
| 7 | 口播/台词 | 该镜头对应的语音逐字稿 |
| 8 | 音效/BGM | 背景音乐情绪或环境音效 |
| 9 | 开始时间 | 格式 MM:SS |
| 10 | 结束时间 | 格式 MM:SS |
| 11 | 时长 | 格式 MM:SS |

- 表格额外包含「视频预览」列：每行内嵌视频播放器，基于该行的开始/结束时间约束播放区间（非物理切分）
- 当前版本仅展示，不支持编辑

### F4 - 导出功能

- 支持将分镜脚本表格导出为 Excel（.xlsx）文件

### F5 - API Key 配置

- 用户输入阿里云百炼 API Key
- 本地存储（localStorage），无需每次输入

---

## 3. 页面布局

单页面应用，参考 UI 原型图（`CE65D81A-9402-4C48-8366-1D53D0B00E17.png`）。

### 顶部

- 功能标签页切换：视频上传、分析结果

### 左侧面板

- **左上区域**：视频上传区（拖拽/点击） + 视频预览播放器
- **左下区域**：分析结果展示模式切换
  - Markdown 模式：渲染 AI 返回的原始 Markdown 内容
  - 表格模式：解析后的分镜脚本结构化表格

### 右侧主区域

- 分镜脚本表格
- 表头：序号、景别、运镜、画面内容、拍摄指导、画面文案/花字、口播/台词、音效/BGM、开始时间、结束时间、时长、视频预览
- 每行右侧：行内视频片段播放器（基于时间区间播放）

### 底部

- 导出 Excel 按钮

---

## 4. 数据流程

```text
用户选择/拖拽视频文件
       ↓
前端校验（格式 / 大小 / 时长）
       ↓
上传至阿里云 OSS（前端直传，STS 临时凭证）
       ↓
获取 OSS 临时访问链接
       ↓
调用百炼 API（视频链接 + 内置提示词）
       ↓
流式接收 AI 分析结果（Markdown 格式）
       ↓
  ┌────────────────┬────────────────────┐
  │  Markdown 模式  │     表格模式        │
  │  直接渲染原始内容 │ 解析为 JSON → 表格  │
  │                │ + 行内视频播放器     │
  └────────────────┴────────────────────┘
       ↓
用户查看 / 导出 Excel
```

---

## 5. 提示词

内置提示词详见 [`docs/prd/v0.2.0/prompt.md`](./prompt.md)。

- 角色：短视频拆解专家及分镜导演
- 输出：11 列 Markdown 表格（序号、景别、运镜、画面内容、拍摄指导、画面文案/花字、口播/台词、音效/BGM、开始时间、结束时间、时长）
- 核心约束：空值填充「-」、时间连续、仅输出表格
- F3 表格模式的字段定义、列顺序、数据格式均以此提示词为准，解析逻辑需严格匹配提示词约定的输出格式
